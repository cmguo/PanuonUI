From 594c1952e5fd897e2d09c3d48bb8d599cdcf1ac0 Mon Sep 17 00:00:00 2001
From: 86183 <86183@DESKTOP-SABKKDC>
Date: Thu, 18 Jul 2019 16:33:01 +0800
Subject: [PATCH] =?UTF-8?q?fix:=E4=BF=AE=E5=A4=8D=E5=AD=A6=E7=94=9F?=
 =?UTF-8?q?=E5=A7=93=E5=90=8D=E8=B6=85=E9=95=BF=E9=97=AE=E9=A2=98?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 Panuon.UI/Z_Others/Converters.cs | 54 ++++++++++++++++++++++++++++++++
 1 file changed, 54 insertions(+)

diff --git a/Panuon.UI/Z_Others/Converters.cs b/Panuon.UI/Z_Others/Converters.cs
index e00cf8b..6704860 100644
--- a/Panuon.UI/Z_Others/Converters.cs
+++ b/Panuon.UI/Z_Others/Converters.cs
@@ -1,6 +1,7 @@
 ﻿using System;
 using System.Globalization;
 using System.Windows;
+using System.Windows.Controls;
 using System.Windows.Data;
 using System.Windows.Media;
 
@@ -375,4 +376,57 @@ namespace Panuon.UI
             return new object[] { DependencyProperty.UnsetValue, DependencyProperty.UnsetValue };
         }
     }
+
+    public class TrimmedTextBlockVisibilityConverter : IValueConverter
+    {
+        public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
+        {
+            if (value == null)
+            {
+                return Visibility.Collapsed;
+            }
+
+            TextBlock textBlock = (TextBlock)value;
+            bool isTrim = IsTextTrimmed(textBlock);
+
+            if (isTrim)
+            {
+                return Visibility.Visible;
+            }
+            else
+            {
+                return Visibility.Visible;
+            }
+        }
+
+        public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
+        {
+            throw new NotImplementedException();
+        }
+
+        /// <summary>
+        /// 判断当前显示的内容是否显示不全被截断
+        /// </summary>
+        /// <param name="textBlock"></param>
+        /// <returns></returns>
+        private bool IsTextTrimmed(TextBlock textBlock)
+        {
+            Typeface typeface = new Typeface(
+                textBlock.FontFamily,
+                textBlock.FontStyle,
+                textBlock.FontWeight,
+                textBlock.FontStretch);
+
+            FormattedText formattedText = new FormattedText(
+                textBlock.Text,
+                System.Threading.Thread.CurrentThread.CurrentCulture,
+                textBlock.FlowDirection,
+                typeface,
+                textBlock.FontSize,
+                textBlock.Foreground);
+            bool isTrimmed = formattedText.Width > textBlock.Width;
+            return isTrimmed;
+        }
+    }
+
 }
-- 
2.21.0.windows.1

